<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wat schaft de StemPot? - De culinaire stemwijzer voor de verkiezingen</title>

    <!-- SEO & Social Sharing Meta Tags -->
    <meta name="description" content="Benieuwd welke politieke partij bij jouw culinaire smaak past? Doe de StemPot, de culinaire stemwijzer over eten, en ontdek welke partij jouw voorkeur heeft.">
    <meta property="og:title" content="Wat schaft de StemPot?">
    <meta property="og:description" content="Ontdek welke politieke partij het beste bij jouw culinaire smaak past met deze stemwijzer.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://placehold.co/600x315/293686/f8f8f8?text=Wat%20schaft%20de%20StemPot?">
    <meta property="og:image:alt" content="Een blauw vlak met de tekst 'Wat schaft de StemPot?'">


    <!-- Favicon -->
    <link rel="icon" href="https://placehold.co/32x32/293686/f8f8f8?text=SP">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Syne:wght@700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Syne:wght@700;800&display=swap"></noscript>
    
    <!-- SwiperJS for Slider -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <style>
        /* --- 1. CSS Variables and General Setup --- */
        :root {
            --color-background: #f8f8f8; /* Off-white */
            --color-primary: #293686;    /* Blue */
            --color-surface: #f8f8f8;   /* Off-white for elements */
            --color-stroke: #1a1a1a;
            --color-text: #1a1a1a;
            --color-text-on-primary: #f8f8f8;
            --color-text-light: #cccccc;
            --border-style: 1px solid var(--color-stroke);
        }

        /* --- 2. Base & Body Styles --- */
        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            padding: 1rem;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            justify-content: center;
            transition: background-color 0.5s ease-in-out;
        }
        
        .background-swiper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transition: opacity 0.5s ease-in-out;
        }
        
        .background-swiper .swiper-slide {
            background-size: cover;
            background-position: center;
        }

        .background-swiper::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
        }

        body.quiz-active .background-swiper,
        body.results-active .background-swiper {
            opacity: 0;
        }


        .container {
            width: 100%;
            max-width: 600px;
            background-color: var(--color-primary);
            border: var(--border-style);
            padding: 2.5rem;
            border-radius: 1rem;
            color: var(--color-text-on-primary);
            transition: max-width 0.4s ease-in-out, min-height 0.4s ease-in-out, background-color 0.4s ease-in-out;
            position: relative;
        }
        

        /* --- 3. Typography & Titles --- */
        h1 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: clamp(2.5rem, 6vw, 3.2rem);
            margin: 0 0 2rem 0;
            text-align: center;
            color: var(--color-text-on-primary);
            transition: font-size 0.3s ease, margin 0.3s ease;
        }

        h1 .underline {
            text-decoration: underline;
            text-decoration-color: var(--color-accent);
            text-decoration-thickness: 3px;
            text-underline-offset: 0.4rem;
            font-weight: 800;
        }
        
        body.quiz-active h1,
        body.results-active h1 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
        }
        
        h2 {
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: var(--color-text-on-primary);
        }

        h3 {
             font-family: 'Lato', sans-serif;
             font-weight: 700;
             font-size: 1.2rem;
             margin-top: 1.5rem;
             margin-bottom: 0.5rem;
             color: var(--color-text-on-primary);
        }

        p {
            line-height: 1.6;
            color: var(--color-text-light);
            margin: 0 0 1.5rem 0;
        }
        p:last-of-type {
            margin-bottom: 0;
        }
        
        .intro p, .intro a {
            color: var(--color-text-on-primary);
        }

        /* --- 4. Main Content Cards (Intro & Steps) --- */
        .card {
            padding: 0;
            border: none;
            margin-bottom: 1.5rem;
        }

        .intro {
            text-align: center;
        }

        .intro.hidden, .page.hidden {
            display: none;
        }

        .step {
            display: none;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
        }
        .step.active {
            display: block;
            opacity: 1;
        }

        .cookie-consent {
            font-size: 0.8rem;
            margin-top: 1.5rem;
        }
        .cookie-consent a {
            color: var(--color-text-light);
        }

        /* --- 5. Progress Bar --- */
        #progress-container {
            width: 100%;
            background-color: var(--color-background);
            height: 10px;
            margin-bottom: 2rem;
            border: var(--border-style);
            padding: 2px;
            border-radius: 999px;
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            background-color: var(--color-stroke);
            transition: width 0.4s ease-in-out;
            border-radius: 999px;
        }

        /* --- 6. Interactive Quiz Options --- */
        .answer-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 0;
        }
        
        input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        label {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: var(--color-surface);
            border: var(--border-style);
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            font-weight: 700;
            height: 100%; 
            border-radius: 0.75rem;
            color: var(--color-text);
        }

        .answer-grid label {
             margin-bottom: 0;
             flex-direction: row;
             text-align: left;
             justify-content: flex-start; 
        }
        
        label:hover {
            background-color: #efefef;
        }

        label:has(input:checked) {
            background-color: #e0e0e0;
            border: 2px solid var(--color-stroke);
        }

        .answer-grid label img {
            width: 60px;
            height: 60px;
            aspect-ratio: 1; /* Maakt de afbeelding vierkant */
            object-fit: cover;
            border: var(--border-style);
            flex-shrink: 0;
            margin-bottom: 0;
            border-radius: 0.5rem;
        }
        
        /* --- Stijlen voor Bonusvraag --- */
        .ice-cream-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
        }

        .ice-cream-grid label {
            flex-direction: column;
            text-align: center;
            padding: 0.75rem;
            height: 100%;
            justify-content: space-between;
        }

        .ice-cream-grid label img {
            width: 100%;
            aspect-ratio: 1; /* Maakt de afbeelding vierkant */
            margin-bottom: 0.75rem;
            object-fit: cover;
            border: var(--border-style);
            border-radius: 0.5rem;
        }
        .ice-cream-grid label span {
            font-size: 0.875rem;
            line-height: 1.3;
        }


        /* --- 7. Navigation & Buttons --- */
        #navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        button {
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 700;
            font-family: 'Lato', sans-serif;
            border: 1px solid var(--color-stroke);
            background-color: var(--color-stroke);
            color: var(--color-surface);
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-radius: 9999px;
        }

        .intro button {
            margin-top: 1.5rem;
            background-color: var(--color-surface);
            color: var(--color-stroke);
        }
        .intro button:hover {
            background-color: #e0e0e0;
        }

        button:hover:not(:disabled) {
            background-color: #333;
        }
        
        button:disabled {
            background-color: #ccc;
            border-color: #ccc;
            cursor: not-allowed;
        }

        #prevBtn, #faqBtn, #restartBtn, .modal-button, #showDetailsBtn, #backToResultBtn {
            background: var(--color-background);
            color: var(--color-stroke);
        }
        #prevBtn:hover:not(:disabled), #faqBtn:hover:not(:disabled), #restartBtn:hover:not(:disabled), .modal-button:hover:not(:disabled), #showDetailsBtn:hover:not(:disabled), #backToResultBtn:hover:not(:disabled) {
            background: #efefef;
        }
        
        #webShareBtn {
            background-color: var(--color-accent);
            border-color: var(--color-accent);
            color: var(--color-text-on-primary);
        }
        #webShareBtn:hover:not(:disabled) {
            background-color: #c02d39;
        }

        .skip-btn {
            width: 100%;
            padding: 1rem;
            background-color: var(--color-surface);
            border: var(--border-style);
            border-radius: 9999px;
            color: var(--color-text);
            font-family: 'Lato', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            text-decoration: none; /* remove underline if any */
        }

        .skip-btn:hover {
            background-color: #e0e0e0;
        }

        .skip-btn-container {
            margin-top: 0.5rem;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .skip-btn-container.visible {
            opacity: 1;
            visibility: visible;
        }

        /* --- 8. Results & Details Page --- */
        #result {
            text-align: center;
            border: none;
            padding: 0;
        }
        
        #result h2 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: var(--color-text-on-primary);
        }

        #result p {
            margin-bottom: 2rem;
            font-size: 1.1rem;
            color: var(--color-text-on-primary);
        }

        #result-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        #result-buttons #faqBtn,
        #result-buttons #restartBtn {
            background: transparent;
            color: var(--color-text-on-primary);
            border: 1px solid var(--color-text-on-primary);
        }

        #result-buttons #faqBtn:hover,
        #result-buttons #restartBtn:hover {
            background: rgba(248, 248, 248, 0.1);
            color: var(--color-text-on-primary);
        }

        #detailsPage h2 {
            text-align: center;
        }

        .choice-item {
            border-bottom: 1px solid rgba(248, 248, 248, 0.2);
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .choice-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .choice-item h3 {
            font-size: 1.1rem;
            margin-top: 0;
            margin-bottom: 0.75rem;
            color: var(--color-text-on-primary);
        }
        .choice-item p {
            margin-bottom: 0.5rem;
            color: var(--color-text-light);
        }
         .choice-item p.user-choice {
            color: var(--color-text-on-primary);
            font-weight: 700;
         }
        
        .center-btn-container {
            text-align: center;
            margin-top: 2rem;
        }
        
        .error-message-container {
            min-height: 1.5em; 
            padding-top: 0.5rem;
            text-align: center;
        }
        .error-message-container p {
            color: var(--color-accent);
            font-weight: 700;
            margin: 0;
        }
        
        /* --- Slider Styles --- */
        .swiper {
            width: 100%;
            height: 100%;
        }
        .swiper-slide {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0 4rem; /* Space for navigation arrows */
        }
        .swiper-slide img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .swiper-button-next, .swiper-button-prev {
            color: var(--color-text-on-primary);
        }


        /* --- 9. Modals --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--color-primary);
            color: var(--color-text-on-primary);
            padding: 2rem;
            border: var(--border-style);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border-radius: 1rem;
        }

        .modal-content h2, .modal-content h3, .modal-content p, .modal-content strong {
            color: var(--color-text-on-primary);
        }

        .modal-content p, .modal-content a {
            color: var(--color-text-light);
        }
        
        .modal-content.text-center {
            text-align: center;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-text-light);
            cursor: pointer;
            border: none;
            background: none;
            padding: 0.5rem;
        }
        .modal-close:hover {
            color: var(--color-text-on-primary);
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* --- 10. Accessibility & Animations --- */
        button:focus-visible, a:focus-visible, .modal-close:focus-visible {
            outline: 3px solid var(--color-accent);
            outline-offset: 2px;
        }

        label:has(input:focus-visible) {
            outline: 3px solid var(--color-accent);
            outline-offset: 2px;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        #completionCounter:empty::before {
            content: "...";
            animation: pulse 1.5s infinite;
        }
        
        .photo-credit {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            z-index: 10;
            transition: opacity 0.3s ease-out;
        }
        .photo-credit a {
            color: inherit;
            text-decoration: underline;
        }
        body.quiz-active .photo-credit,
        body.results-active .photo-credit {
            opacity: 0;
            pointer-events: none;
        }
        
        /* --- 11. Mobile Responsiveness --- */
        @media (min-width: 481px) and (max-width: 1023px) {
             .answer-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .answer-grid label {
                 flex-direction: column;
                 text-align: center;
                 justify-content: space-between; 
            }
            .answer-grid label img {
                width: 100%;
                height: auto;
                aspect-ratio: 1;
                margin-bottom: 0.75rem;
            }
        }

        @media (max-width: 1023px) {
            body {
                justify-content: flex-start;
                padding-top: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 0.5rem;
            }
            .container {
                padding: 1.5rem 1rem; /* Less padding on mobile */
            }
            h1 {
                font-size: clamp(2rem, 8vw, 2.5rem); /* Slightly smaller h1 on mobile */
            }
            .answer-grid {
                gap: 0.75rem; /* Smaller gap */
            }
            .answer-grid label {
                padding: 0.75rem; /* Smaller padding inside cards */
            }
            .answer-grid label span {
                font-size: 0.875rem; /* Smaller font for the text */
                line-height: 1.4;
            }
            .ice-cream-grid {
                gap: 0.5rem;
            }
            .ice-cream-grid label {
                padding: 0.5rem;
            }
        }
        
        /* --- 12. Desktop Responsiveness --- */
        @media (min-width: 1024px) {
            body.quiz-active .container {
                max-width: 90vw; /* Wider container on desktop */
                min-height: 90vh;
                display: flex;
                flex-direction: column;
            }

            body.quiz-active #quizForm {
                display: flex;
                flex-direction: column;
                flex-grow: 1;
            }
            
            body.quiz-active .step.active {
                display: flex;
                flex-direction: column;
                flex-grow: 1;
            }
            
            body.quiz-active .step.active .card {
                flex-grow: 1;
                display: flex;
                flex-direction: column;
            }
            
            body.quiz-active .step.active .card h2 {
                text-align: center;
            }
            
            body.quiz-active .answer-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 columns in a row */
                flex-grow: 1;
                grid-auto-rows: 1fr;
            }
            
            body.quiz-active .answer-grid label {
                flex-direction: column;
                justify-content: space-between;
            }
            
            body.quiz-active .answer-grid label span {
                font-size: clamp(0.9rem, 1.2vw, 1.1rem);
            }
            
            body.quiz-active .answer-grid label img {
                aspect-ratio: 1;
                width: 100%;
                height: auto;
                margin-bottom: 0.75rem;
            }
            
            .ice-cream-grid {
               grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            
            body.quiz-active .ice-cream-grid {
                flex-grow: 1;
                grid-auto-rows: 1fr;
            }
            
            body.quiz-active .skip-btn {
                width: auto;
                display: inline-block;
                padding: 0.8rem 3rem;
            }
            
            .swiper-slide {
                flex-direction: column;
                gap: 0;
                text-align: center;
                align-items: center;
                justify-content: center;
                padding: 2rem 6rem;
            }

            .swiper-slide img {
                width: 250px;
                height: 250px;
                margin-bottom: 2rem;
                flex-shrink: 0;
            }

            .slide-text-content {
                flex-grow: 1;
            }
        }

    </style>
</head>
<body>

<div class="background-swiper">
    <div class="swiper-wrapper">
    </div>
</div>

<div class="container">
    <h1>Wat schaft de <span class="underline">Stem</span>Pot?</h1>

    <div class="intro" id="intro">
        <p>Een loempia, een linzencurry of toch stamppot met jus?<br>
Wat jij lekker vindt, zegt soms verrassend veel over je politieke voorkeur.</p>
        <p>De StemPot is een culinaire stemwijzer die je helpt ontdekken welke partij het beste bij jouw smaak past. Geen droge verkiezingstest, maar een smakelijke politieke kennismaking.</p>
        <button id="startBtn">Start de stemwijzer</button>
        <p class="cookie-consent">Deze site gebruikt een anoniem cookie om bij te houden hoe vaak de stemwijzer is gedaan. Door te starten ga je akkoord. <a href="#" id="privacyLink">Meer info</a>.</p>
    </div>

    <form id="quizForm" style="display:none;">
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>

        <!-- Vragen worden hier dynamisch ingeladen -->
        <div id="quiz-steps-container"></div>

        <div id="navigation">
            <button type="button" id="prevBtn">Terug</button>
            <button type="button" id="nextOrSubmitBtn">Volgende</button>
        </div>
    </form>

    <div id="result" class="card page hidden"></div>
    
    <div id="detailsPage" class="page hidden">
        <h2>Jouw culinaire analyse</h2>
        <div id="detailsContent">
             <!-- Slider main container -->
            <div class="swiper">
              <div class="swiper-wrapper">
                <!-- Slides will be injected here by JavaScript -->
              </div>
              <!-- If we need navigation buttons -->
              <div class="swiper-button-prev"></div>
              <div class="swiper-button-next"></div>
            </div>
        </div>
        <div class="center-btn-container">
           <button id="backToResultBtn">Terug naar uitslag</button>
        </div>
    </div>

    <div class="modal-overlay" id="faqModal">
        <div class="modal-content">
            <button class="modal-close" id="closeFaqBtn" aria-label="Sluit venster">&times;</button>
            <h2>Veelgestelde Vragen (FAQ)</h2>
            <h3>Is dit een betrouwbaar stemadvies?</h3>
            <p>Niet echt. Deze culinaire stemwijzer is geen serieus stemadvies, maar wel goed voor een lach.</p>
            
            <h3>Hoe wordt mijn uitslag berekend?</h3>
            <p>Dat is een geheim van de chef.</p>

            <h3>Hoe vaak is deze stemwijzer al ingevuld?</h3>
            <p>Deze stemwijzer is al <strong id="completionCounter"></strong> keer ingevuld.</p>

            <h3>Welke partij past bij mijn smaak?</h3>
            <p>Met een beetje geluk staat jouw favoriete saus in het verkiezingsprogramma van de partij die het beste bij jouw smaak past.</p>

            <h3>Wat als mijn vraag er niet bij zit?</h3>
            <p>Dan is het blijkbaar geen veelgestelde vraag.</p>

            <h3>Ik heb zin in loempia's gekregen. Waar vind ik een loempiakraam bij mij in de buurt?</h3>
            <p>Dat weten we op <a href="https://loempiaradar.nl/" target="_blank" rel="noopener noreferrer">Loempia Radar</a>.</p> 
        </div>
    </div>
    
    <div class="modal-overlay" id="locationModal">
        <div class="modal-content text-center">
            <h2>Patat of Friet?</h2>
            <p>Om te bepalen of het patat of friet is, hebben we je locatie nodig. Nadat je op 'Akkoord' klikt, zal je browser om definitieve toestemming vragen. Als je geen toestemming geeft, is het sowieso patat.</p>
            <div class="modal-buttons">
                <button id="declineLocationBtn" class="modal-button">Nee, bedankt</button>
                <button id="acceptLocationBtn" class="modal-button">Akkoord</button>
            </div>
        </div>
    </div>
</div>

<div class="photo-credit">
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script type="module">
    // --- App Initialisatie ---
    document.addEventListener('DOMContentLoaded', async () => {
        
        let db, auth, counterRef;
        let firebaseInitialized = false;
        let quizData = null;

        async function initializeFirebase() {
            if (firebaseInitialized) return;
            try {
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
                const { getAuth, signInAnonymously } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");
                const { getFirestore, doc, getDoc, setDoc, increment, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");

                const firebaseConfig = {
                    apiKey: "AIzaSyBKyEKfccd1dosWB4l-SzBK_StO35mUtpA",
                    authDomain: "stempot-84eb5.firebaseapp.com",
                    projectId: "stempot-84eb5",
                    storageBucket: "stempot-84eb5.appspot.com",
                    messagingSenderId: "871528886963",
                    appId: "1:871528886963:web:efb392f2cbb881e05f36c6",
                    measurementId: "G-6K79MBVXLD"
                };
                
                const appId = 'stempot-quiz';
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                await signInAnonymously(auth);
                console.log("Firebase succesvol geïnitialiseerd en anoniem ingelogd.");
                counterRef = doc(db, `counters/${appId}`);
                firebaseInitialized = true;
            } catch (e) {
                console.error("Firebase initialisatie is mislukt.", e);
            }
        }

        // --- Bonus Vraag Logica ---
        const temperatureThreshold = 25;
        
        async function getTemperature(lat, lon) {
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await response.json();
                return data.current_weather.temperature;
            } catch (error) {
                console.error("Could not fetch temperature:", error);
                return null; // Return null on error
            }
        }

        async function handleBonusQuestion(lat = 52.09, lon = 5.12) { // Utrecht as fallback
            const currentTemperature = await getTemperature(lat, lon);
            const bonusStep = document.getElementById('bonusStep');
            if (bonusStep && (currentTemperature === null || currentTemperature < temperatureThreshold)) {
                bonusStep.remove();
            }
        }


        // --- DOM Elementen ---
        const intro = document.getElementById('intro');
        const startBtn = document.getElementById('startBtn');
        const form = document.getElementById('quizForm');
        const resultDiv = document.getElementById('result');
        const detailsPage = document.getElementById('detailsPage');
        const detailsContent = document.getElementById('detailsContent');
        const stepsContainer = document.getElementById('quiz-steps-container');
        const prevBtn = document.getElementById('prevBtn');
        const nextOrSubmitBtn = document.getElementById('nextOrSubmitBtn');
        const progressBar = document.getElementById('progress-bar');
        const faqModal = document.getElementById('faqModal');
        const closeFaqBtn = document.getElementById('closeFaqBtn');
        const privacyLink = document.getElementById('privacyLink');
        const locationModal = document.getElementById('locationModal');
        const acceptLocationBtn = document.getElementById('acceptLocationBtn');
        const declineLocationBtn = document.getElementById('declineLocationBtn');
        const photoCreditDiv = document.querySelector('.photo-credit');
        let currentStepIndex = 0;
        let skipCount = 0;
        let skipButtonTimeout;
        
        let visibleSteps = [];
        
        // --- Background Slideshow ---
        const backgroundImages = [
            { 
                url: 'https://prod-img.limburger.nl/public/ece-incoming/yz54jj-geert-wilders-aan-de-friet-bij-de-favoriete-frietzaak-uit-zijn-venlose-jeugd-cafetaria-van-lier./alternates/THREE_TWO_1620/Geert%20Wilders%20aan%20de%20friet%20bij%20de%20%20favoriete%20frietzaak%20uit%20zijn%20Venlose%20jeugd%20cafetaria%20Van%20Lier.',
                credit: { name: 'De Limburger / ANP', link: 'https://www.limburger.nl/' }
            },
            { 
                url: 'https://image.volkskrant.nl/112773005/width/2480/maandag-20-februari-bami-met-cha-sieuw-peilingwijzer-15-tot',
                credit: { name: 'De Volkskrant', link: 'https://www.volkskrant.nl/' }
            },
            {
                url: 'https://images.gelderlander.nl/YjlmZjNkOTVkM2I2OTk3ZjEwZWEvZGlvLzIyODcwMDY0MC9maWxsLzEzNDkvOTAw/bbb-partijleider-caroline-van-der-plas-verorbert-op-het-partijbureau-in-colmschate-een-broodje-uitsmijter-bereid-door-haar-zoon-kyle-links',
                credit: { name: 'De Gelderlander', link: 'https://www.gelderlander.nl/' }
            }
        ];
        
        const bgSwiperWrapper = document.querySelector('.background-swiper .swiper-wrapper');
        backgroundImages.forEach(img => {
            const slide = document.createElement('div');
            slide.className = 'swiper-slide';
            slide.style.backgroundImage = `url('${img.url}')`;
            bgSwiperWrapper.appendChild(slide);
        });

        const bgSwiper = new Swiper('.background-swiper', {
            loop: true,
            autoplay: {
                delay: 4000,
                disableOnInteraction: false,
            },
            effect: 'fade',
            fadeEffect: {
                crossFade: true
            },
            on: {
                slideChange: function () {
                    const currentCredit = backgroundImages[this.realIndex].credit;
                    photoCreditDiv.innerHTML = `Foto: <a href="${currentCredit.link}" target="_blank" rel="noopener noreferrer">${currentCredit.name}</a>`;
                }
            }
        });
        
        // Set initial credit
        const initialCredit = backgroundImages[bgSwiper.realIndex].credit;
        photoCreditDiv.innerHTML = `Foto: <a href="${initialCredit.link}" target="_blank" rel="noopener noreferrer">${initialCredit.name}</a>`;

        // --- Quiz & Locatie Logica ---
        startBtn.addEventListener('click', () => {
            locationModal.classList.add('open');
        });

        function startQuiz() {
            visibleSteps = [...document.querySelectorAll('.step')];
            locationModal.classList.remove('open');
            intro.classList.add('hidden');
            form.style.display = 'block';
            document.body.classList.add('quiz-active');
            currentStepIndex = 0;
            showStep(currentStepIndex);
        }
        
        function handleLocation(permissionGranted) {
            if (permissionGranted && navigator.geolocation) {
                 navigator.geolocation.getCurrentPosition(async (position) => {
                     const latitude = position.coords.latitude;
                     if (latitude < 51.8) {
                         const patatSpan = document.getElementById('patat-text');
                         if(patatSpan) patatSpan.textContent = "Frietje oorlog.";
                     }
                     await handleBonusQuestion(latitude, position.coords.longitude);
                     startQuiz();
                 }, async (error) => {
                     console.warn("Locatie niet verkregen:", error.message);
                     await handleBonusQuestion(); // Fallback to Utrecht
                     startQuiz();
                 });
             } else {
                 handleBonusQuestion().then(startQuiz);
             }
        }

        acceptLocationBtn.addEventListener('click', () => {
            handleLocation(true);
        });

        declineLocationBtn.addEventListener('click', () => {
            handleLocation(false);
        });

        function showStep(index) {
            clearTimeout(skipButtonTimeout);

            visibleSteps.forEach((step, i) => {
                step.classList.toggle('active', i === index);
                const skipContainer = step.querySelector('.skip-btn-container');
                if (skipContainer) {
                    skipContainer.classList.remove('visible');
                }
            });

            const activeStep = visibleSteps[index];
            if (activeStep) {
                const activeSkipContainer = activeStep.querySelector('.skip-btn-container');
                if (activeSkipContainer) {
                    skipButtonTimeout = setTimeout(() => {
                        activeSkipContainer.classList.add('visible');
                    }, 5000);
                }
            }
            
            const progress = (index / (visibleSteps.length - 1)) * 100;
            progressBar.style.width = `${progress}%`;
            
            nextOrSubmitBtn.textContent = (index === visibleSteps.length - 1) ? 'Bekijk jouw uitslag' : 'Volgende';
        }

        function advanceQuiz() {
            if (currentStepIndex < visibleSteps.length - 1) {
                currentStepIndex++;
                showStep(currentStepIndex);
            } else {
                submitQuiz();
            }
        }

        form.addEventListener('change', (e) => {
            if (e.target.type === 'radio') {
                setTimeout(() => {
                    advanceQuiz();
                }, 350); 
            }
        });

        nextOrSubmitBtn.addEventListener('click', () => {
            const activeStep = visibleSteps[currentStepIndex];
            const inputs = activeStep.querySelectorAll('input[type="radio"]');
            
            const errorContainer = activeStep.querySelector('.error-message-container');
            errorContainer.innerHTML = ''; // Clear previous error

            if (![...inputs].some(i => i.checked)) {
                errorContainer.innerHTML = '<p>Kies een antwoord om door te gaan.</p>';
                return;
            }
            advanceQuiz();
        });


        prevBtn.addEventListener('click', () => {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                showStep(currentStepIndex);
            } else {
                form.style.display = 'none';
                intro.classList.remove('hidden');
                document.body.classList.remove('quiz-active');
            }
        });

        form.addEventListener('click', (e) => {
            if (e.target.classList.contains('skip-btn')) {
                skipCount++;
                advanceQuiz();
            }
        });

        function submitQuiz() {
            incrementCompletionCount();
            document.body.classList.remove('quiz-active');
            document.body.classList.add('results-active');

            const { partyDescriptions, justifications, tieBreakers } = quizData;

            const formData = new FormData(form);
            const scores = {};
            let answeredQuestions = 0;
            for (const [questionName, party] of formData.entries()) {
                const tieBreakerKey = `${questionName}_${party}`;
                const points = tieBreakers && tieBreakers[tieBreakerKey] ? 1.01 : 1;
                scores[party] = (scores[party] || 0) + points;
                answeredQuestions++;
            }
            
            const userChoices = [];
            visibleSteps.forEach(step => {
                const questionElement = step;
                const questionInput = questionElement.querySelector('input[type="radio"]');
                if (!questionInput) return;
                
                const questionName = questionInput.name;
                const questionText = questionElement.querySelector('h2').textContent;
                const chosenParty = formData.get(questionName);

                if (chosenParty) {
                    const answerLabel = questionElement.querySelector(`input[value="${chosenParty}"]`).closest('label');
                    const answerText = answerLabel.querySelector('span').textContent;
                    const answerImg = answerLabel.querySelector('img').src;
                    const justification = justifications[questionName]?.[chosenParty] || "Een onverklaarbaar goede keuze.";
                    userChoices.push({
                        question: questionText,
                        answer: answerText,
                        image: answerImg,
                        justification: justification,
                        party: chosenParty
                    });
                } else {
                    userChoices.push({
                        question: questionText,
                        answer: 'Overgeslagen',
                        image: 'https://placehold.co/150x150/f8f8f8/1a1a1a?text=?',
                        justification: 'Een lastige keuze, blijkbaar. Dit is het culinaire equivalent van een blanco stem. Een teken van een echte zwever.',
                        party: 'Zwever'
                    });
                }
            });
            
            sessionStorage.setItem('quizChoices', JSON.stringify(userChoices));

            let resultTitle;
            let resultDescription;
            let finalWinnerString;

            if (skipCount >= 5 || answeredQuestions < 5) {
                finalWinnerString = 'een culinaire zwever';
                resultTitle = 'Jij bent een culinaire zwever!';
                resultDescription = partyDescriptions['Zwever'];
            } else {
                let maxScore = 0;
                let winner = '';
                for (const party in scores) {
                    if (scores[party] > maxScore) {
                        maxScore = scores[party];
                        winner = party;
                    }
                }
                
                finalWinnerString = winner;
                resultTitle = `Jij stemt met je vork op <strong>${finalWinnerString}</strong> 🍽️`;
                resultDescription = partyDescriptions[finalWinnerString] || 'Geen duidelijke winnaar!';
            }
            
            resultDiv.innerHTML = `
                <h2>${resultTitle}</h2>
                <p>${resultDescription}</p>
                <p style="font-size: 0.9rem; margin-top: 2rem; color: var(--color-text-light);">Hoe we tot deze uitslag zijn gekomen? <a href="#" id="showDetailsLink" style="text-decoration: underline; color: var(--color-text-on-primary); font-weight: 700;">Bekijk hier je keuzes.</a></p>
                <div id="result-buttons">
                    <button id="webShareBtn">Deel je resultaat</button>
                    <button id="restartBtn">Opnieuw</button>
                    <button id="faqBtn">FAQ</button>
                </div>
            `;
            resultDiv.dataset.winner = finalWinnerString; 

            progressBar.style.width = `100%`;
            resultDiv.classList.remove('hidden');
            form.style.display = 'none';
        }
        
        document.body.addEventListener('click', async (e) => {
            if (e.target.id === 'restartBtn') {
                resetForm();
            }
            if (e.target.id === 'showDetailsLink') {
                e.preventDefault();
                displayDetailsPage();
            }
            if (e.target.id === 'backToResultBtn') {
                detailsPage.classList.add('hidden');
                resultDiv.classList.remove('hidden');
                document.body.classList.remove('quiz-active');
                document.body.classList.add('results-active');
            }
            if (e.target.id === 'webShareBtn') {
                const winner = resultDiv.dataset.winner || 'een culinaire zwever';
                const shareText = `Mijn culinaire politieke voorkeur is ${winner}. Ontdek de jouwe en doe ook de StemPot!`;
                const shareData = {
                    title: 'Wat schaft de StemPot?',
                    text: shareText,
                    url: window.location.href,
                };

                try {
                    if (navigator.share) {
                        await navigator.share(shareData);
                    } else {
                        throw new Error('Web Share API niet ondersteund');
                    }
                } catch (err) {
                    console.log('Web Share mislukt, fallback naar klembord:', err);
                    try {
                        const copyText = `${shareText} ${shareData.url}`;
                        const textArea = document.createElement("textarea");
                        textArea.value = copyText;
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            const originalText = e.target.textContent;
                            e.target.textContent = 'Link gekopieerd!';
                            setTimeout(() => {
                                e.target.textContent = originalText;
                            }, 2000);
                        } catch (err) {
                             console.error('Kopiëren naar klembord is ook mislukt', err);
                        }
                        document.body.removeChild(textArea);
                    } catch (copyErr) {
                        console.error('Kopiëren naar klembord is ook mislukt', copyErr);
                    }
                }
            }
            if (e.target.id === 'faqBtn') {
                getCompletionCount();
                faqModal.classList.add('open');
            }
        });

        function formatAnswerText(text) {
            if (!text || typeof text !== 'string') return '';
            let cleanedText = text.trim();
            if (cleanedText.endsWith('.') || cleanedText.endsWith('?') || cleanedText.endsWith('!')) {
                cleanedText = cleanedText.slice(0, -1);
            }
            return cleanedText.charAt(0).toLowerCase() + cleanedText.slice(1);
        }

        let usedJustificationIndices = [];
        let usedSkippedIndices = [];

        function getPersonalizedJustification(choice) {
            const { justifications } = quizData;
            const formattedAnswer = formatAnswerText(choice.answer);
            const templates = [
                `Jouw keuze voor ${formattedAnswer}? Dat is pure ${choice.party}-logica. ${choice.justification}`,
                `Met de keuze voor ${formattedAnswer} is het duidelijk dat jouw culinaire kompas richting ${choice.party} wijst. ${choice.justification}`,
                `Ah, ${formattedAnswer}! Dat zien we vaker bij fijnproevers met een ${choice.party}-voorkeur. ${choice.justification}`,
                `Een klassieker! Dit is er eentje rechtstreeks uit het kookboek van ${choice.party}. ${choice.justification}`,
                `Door voor ${formattedAnswer} te gaan, laat je een duidelijke ${choice.party}-signatuur achter op je bord. ${choice.justification}`,
                `Interessant. Deze keuze voor ${formattedAnswer} schreeuwt gewoon ${choice.party}. ${choice.justification}`,
                `Dat je kiest voor ${formattedAnswer} is een duidelijk signaal. ${choice.justification} Precies wat je van een ${choice.party}-stemmer verwacht.`,
                `${choice.justification} Het is dan ook geen verrassing dat je voor ${formattedAnswer} ging, een typische ${choice.party}-keuze.`,
                `De keuze voor ${formattedAnswer} zegt veel. ${choice.justification} Dit past naadloos in het culinaire profiel van ${choice.party}.`,
                `Natuurlijk koos je voor ${formattedAnswer}. ${choice.justification} Dat had een ${choice.party}-aanhanger niet beter kunnen doen.`,
                `Je culinaire kompas slaat duidelijk uit naar ${choice.party} met je keuze voor ${formattedAnswer}. ${choice.justification}`,
                `${choice.justification} Deze voorkeur voor ${formattedAnswer} is een schoolvoorbeeld van de ${choice.party}-eetcultuur.`
            ];
            
            if (usedJustificationIndices.length === templates.length) {
                usedJustificationIndices = []; // Reset if all have been used
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * templates.length);
            } while (usedJustificationIndices.includes(randomIndex));
            
            usedJustificationIndices.push(randomIndex);
            return templates[randomIndex];
        }

        function getSkippedJustification() {
             const templates = [
                "Hier kon je geen keuze maken. Een typisch geval van culinaire besluiteloosheid, wat je in de hoek van de zwevende kiezer plaatst.",
                "Deze vraag heb je overgeslagen. Twijfel in de keuken is als twijfel in het stemhokje: het leidt tot een blanco stem.",
                "Geen antwoord hier. Je houdt je kaarten (en je menukeuze) dicht tegen de borst. Een strategische zet van een ware zwever.",
                "Je hebt gepast op deze vraag. Soms is de beste keuze geen keuze maken. Dat is de filosofie van de culinaire zwever.",
                "Een overgeslagen vraag. Je weigert je te conformeren aan de aangeboden opties. Een rebel zonder culinaire zaak.",
                "Je onthoudt je hier van stemming. Een culinair neutraal standpunt, kenmerkend voor de strategische zwever.",
                "Deze vraag laat je links liggen. Je bent duidelijk nog in de oriënterende fase van je culinaire reis.",
                "Keuzestress? Of een bewuste keuze om je niet te binden? Hoe dan ook, een klassieke zwever."
            ];

            if (usedSkippedIndices.length === templates.length) {
                usedSkippedIndices = []; // Reset
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * templates.length);
            } while (usedSkippedIndices.includes(randomIndex));

            usedSkippedIndices.push(randomIndex);
            return templates[randomIndex];
        }
        
        let swiper;

        function displayDetailsPage() {
            usedJustificationIndices = []; // Reset for each view
            usedSkippedIndices = []; // Reset for each view

            const choices = JSON.parse(sessionStorage.getItem('quizChoices'));
            const isDesktop = window.innerWidth >= 1024;
            
            document.body.classList.add('results-active'); // Keep the results styling

            if (!choices) {
                detailsContent.innerHTML = '<p>Er zijn geen keuzes gevonden om weer te geven.</p>';
            } else {
                if (isDesktop) {
                    const sliderWrapper = detailsContent.querySelector('.swiper-wrapper');
                    sliderWrapper.innerHTML = choices.map(choice => {
                         const justificationHtml = choice.answer === 'Overgeslagen'
                            ? `<p><em>${getSkippedJustification()}</em></p>`
                            : `<p><em>${getPersonalizedJustification(choice)}</em></p>`;
                        return `
                        <div class="swiper-slide">
                            <img src="${choice.image}" alt="${choice.answer}" loading="lazy" width="250" height="250">
                            <div class="slide-text-content">
                                <h3>${choice.question}</h3>
                                <p class="user-choice">${choice.answer}</p>
                                ${justificationHtml}
                            </div>
                        </div>`;
                    }).join('');

                    if (swiper) {
                        swiper.destroy(true, true);
                    }
                    swiper = new Swiper('.swiper', {
                        navigation: {
                            nextEl: '.swiper-button-next',
                            prevEl: '.swiper-button-prev',
                        },
                    });

                } else {
                     detailsContent.innerHTML = choices.map(choice => {
                        const justificationHtml = choice.answer === 'Overgeslagen'
                            ? `<p><em>${getSkippedJustification()}</em></p>`
                            : `<p><em>${getPersonalizedJustification(choice)}</em></p>`;

                        return `
                            <div class="choice-item">
                                <h3>${choice.question}</h3>
                                <p class="user-choice">${choice.answer}</p>
                                ${justificationHtml}
                            </div>`;
                    }).join('');
                }
            }
            resultDiv.classList.add('hidden');
            detailsPage.classList.remove('hidden');
        }

        privacyLink.addEventListener('click', (e) => {
            e.preventDefault();
            getCompletionCount();
            faqModal.classList.add('open');
        });

        closeFaqBtn.addEventListener('click', () => {
            faqModal.classList.remove('open');
        });
        faqModal.addEventListener('click', (e) => {
            if (e.target === faqModal) {
                faqModal.classList.remove('open');
            }
        });

        function resetForm() {
            document.body.className = '';
            form.reset();
            currentStepIndex = 0;
            skipCount = 0;
            resultDiv.classList.add('hidden');
            detailsPage.classList.add('hidden');
            resultDiv.innerHTML = '';
            intro.classList.remove('hidden');
            form.style.display = 'none';
            sessionStorage.removeItem('quizState');
        }

        async function incrementCompletionCount() {
            if (window.self !== window.top) {
                console.log("Test mode: counter not incremented.");
                return;
            }
            if (!firebaseInitialized) await initializeFirebase();
            if (!counterRef) return;
            try {
                await setDoc(counterRef, { 
                    count: increment(1),
                    lastUpdated: serverTimestamp() 
                }, { merge: true });
                 console.log("Teller succesvol bijgewerkt.");
            } catch (e) {
                console.error("Fout bij het bijwerken van de teller:", e);
            }
        }

        async function getCompletionCount() {
            if (!firebaseInitialized) await initializeFirebase();
            if (!counterRef) return;
            const counterSpan = document.getElementById('completionCounter');
            counterSpan.textContent = '';
            try {
                const docSnap = await getDoc(counterRef);
                if (docSnap.exists()) {
                    const count = docSnap.data().count;
                    counterSpan.textContent = count.toLocaleString('nl-NL');
                    
                    if (count % 250 === 0 && count > 0) {
                        confetti({
                            particleCount: 150,
                            spread: 90,
                            origin: { y: 0.6 }
                        });
                    }
                } else {
                    counterSpan.textContent = '0';
                }
            } catch (e) {
                console.error("Fout bij ophalen van de teller:", e);
                counterSpan.textContent = 'onbekend';
            }
        }
        
        // Save and restore state
        window.addEventListener('beforeunload', () => {
            if (document.body.classList.contains('quiz-active')) {
                const answers = {};
                const formData = new FormData(form);
                for (const [key, value] of formData.entries()) {
                    answers[key] = value;
                }
                const state = {
                    currentStepIndex,
                    answers
                };
                sessionStorage.setItem('quizState', JSON.stringify(state));
            }
        });

        const savedState = sessionStorage.getItem('quizState');
        if (savedState) {
            const { currentStepIndex: savedIndex, answers } = JSON.parse(savedState);
            startQuiz();
            currentStepIndex = savedIndex;
            for (const [name, value] of Object.entries(answers)) {
                const input = form.querySelector(`input[name="${name}"][value="${value}"]`);
                if (input) {
                    input.checked = true;
                }
            }
            showStep(currentStepIndex);
        }
    });
</script>

</body>
</html>
